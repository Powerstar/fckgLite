rev 11-May_12-08_31

01 Oct 2009
    Temporary fix to security in media and link tools, preventing any user access to toolbar
    who is not a registered user. In edit.php fckg_edit_meta:  returns if non-user, so that
    editor doesn't load.
      
03 Oct 2009
fixed security hole in media and link tools  
    1. Added new configuration options to conf/metadata.php: guest_toolbar and guest_media.
    These work in conjunction with two new toolbars are defined in fckconfig.js,
    DokuwikiNoGuest and DokuwikiGuest for non_registered users: 
      		guest_toolbar == 0:  DokuwikiNoGuest
      		guest_media == 1:    DokuwikiGuest
      		
   2. Defined two new user types in registerOnLoad() of fckg/helper.php: visitor and user;
   the appropriate type is assigned to the FCKeditor's editorInstance in the Javascript
   function FCKeditor_OnComplete() which is written to the browser from registerOnLoad(). 
   This makes the distinction between a visitor and a registered user available to FCKeditor,
   so that the upload facilities can be turned off for visitors in the link and media tools. 
   This required modifications to fckeditor/editor/filemanager/browser/default:
            browser.html, frmcreatefolder.html, frmupload.html
   and to fckeditor/editor/dialog/
           fck_image/fck_image.js and fck_link/fck_link.js   
 
05 Oct 2009
 Added Support for Samba Shares (fckeditor/dialog/fck_link.html,
   fckeditor/dialog/fck_link/fck_link.js, DokuWikiFCK.pm)
   
06 Oct 2009
 Added Fit Window tool to toolbar.    
 
07 Oct 2009
 fck_editorarea.css:  th { font-weight: bold; }
  
18 Oct 2009
 Added configuration option 'open_upload', which defaults to false.  Setting this
 to true allows non-registered users to upload files to the server.  To implement
 this option, fckg/helper.php tests for 
           $open_upload = $this->getConf('open_upload');  
 and if true, it assigns 'user' status to the guest, instead of 'visitor'.  

25 Oct 2009
  Added Support for nesting ordered lists

27 Oct 2009
  Fixed bug in image markup, adding initial ':' to namespace of images, otherwise when an image
  is in the top level directory it is not found by DW.
  
  Found CSS workaround so that centered images are centered in the editor, with thanks
  to
     Larisa Thomason,  Senior Web Analyst,   NetMechanic, Inc. 
     http://www.netmechanic.com/news/vol7/html_no10.htm
  Created code for incorporating DW markup for positioning of images
       
28 Oct 2009
 Simplified Link and Image Properties dialogues so that they show only those elements
 which apply to fckgLite.
 
 Fixed bug in fck_image.js so that left align gets a class='media' to erase previous
 class attributions, which would cause image to hold previous position

 Removed link markup from local images, so that they behave as expected when clicked,
 i.e. link originates from DokuWiki's detail.php script and points to page with image
 and image details
 
29 Oct 2009
 Re-wrote fallback code for loading of scripts in edit.php.  In some instances the
 HTMLParser class wasn't  being loaded in time(or at all?).
 
31 Oct 2009
 Removed mutliple colons which built up at start of local image names -- inserted test
 to see if name started with clon (this had already been done for namespaces) 

1 Nov 2009
 Fixed lost brackets enclosing Samba shares; lost when local_image var was implemented:
 required locl_image = false, when shares are identified and url's set
  
 Fixed spacing on right side of link markup, so that the space is not removed, butting
 link up against following character, as in [link]char
  
 Added new-line to start of lists, otherwise if they are preceded by text, they
 will not be treated as list items
 
 Removed new-line from end tag of <code> markup, mainly in deference to IE, which
 adds compounded new-lines to bottoms of non-parsed blocks, when it finds a 
 new-line at end of block.  Now it adds one new-line in editor but when the
 text is parsed and saved this new-line is removed.
 
 2 Nov 2009
 Moved 1 Nov spacing fix from save.php to javascript.  

 Updated experimental scripts to conform with 1-2 Nov changes
 
    
3 Nov 2009
  Implemented support for geshi code blocks
  
  Variety of fixes in relation to spaces handling
  
  Fixed formatted links, so that formatting code no longer prints to screen when modifying
  link text
  
4 Nov
  Added check for INFO[userinfo] when checking for lock-timer group in edit.php, to
  avoid PHP warning (when open wiki)
  
 Fixed broken tables (reported by Jean=Claude Rosenthal); caused by deletion of 
 regex in chars: that deletes initial space and new-line characters, causing
 newlines to be inserted for each cell (pipe).

4 November p.m.
 Made changes to fckeditor/editor/filemanager/connectors/php/config.php which will
 hopefully give windows users easy access to the FCKeditor's file browser.  Now
 recognition of Windows is automatic and the path to data/media is automatically
 set.

5 November 2009
 Fixed path recognition for images fetched using Windows-style file manager with
 additional regex under attributes for img src in parse_wikitext function of edit.php.   

 Added checkbox to browser window so that users can choose to select the windows
 style file manager.  Required update to fckeditor's php connector: config.php

7 November
 Set "FCK Preview" button to style="display:inline" so that it always appears
  
 Fixed column span for th cells.
 
Nov 8 2009 
 [6:56] Added spaces to right of image markup for image align = left


11 Nov 2009
 Implemented a checkbox on FCK Preview Screen wich enables the Prview Button.  It comes
 a warning that work can be lost.
 
 Reworked the FCKeditors' Table Cell dialog so that it attaches DW's centeralign,
 leftalign, and  and rightalign classes to the cells, so as to replicatle DW' alignment
 protocol.
 
 Fixed the cell alignment but still to do is cell alignment for colspans.
 
12 Nov 2009 10:53
 Rewrote . ./filemanager/conncectors/php/config.php 
 The aim is to accommodate aall systems with auto-detect while giving use opportunity
 to enter pahts to data/media manually if needed
  
 1:04
 Fixed config.php so that it recognizes difference between Darwin and Windows, i.e.
 so that stristr looking for WIN doesn't mistake Darwin for Windows
 
 13 Nov 2008
 6:55  Fixed centering on table cells with colspan greater than 1.  Note: each time
 a cell increases its span, the center align has to be reset.
 
 15 November 2008
 Implemented re-sizing of editor window helper.php and edit.php, replacing DW's size__ctrl
 div with fck_size_ctrl div in keper.php and adding js function to increase and decrease
 size via dwfck_size_ctl() in edit.php
 
 Implemented support for non-printable chars: * / <
 
 
 15 Nov 22:38
 Added tool tips to smaller and larger buttons (for decreasing and increasing window size)
 
 Added smb icon to fckeditor images and smb CSS to fck_editorarea.css
  
 16 Nov 
 8:36  Removed autogrow plugin from FCKeditor, now that edit window is resizable.  This
 also improves functioning of fit window tool, which no longer collapses to the
 autogrow maximum height.
 
 20 Nov 2009
 Implemented support for DokuWiki footnotes
 
 16:17  Fixed regex bug in IE, where it doesn't split correctly on underscor character
 when it is followed by a second underscore (treats both a single character instead of 
 two).
     
 17:04 Fixed bug which printed %% escapes in code blocks
 
 21:07 Conformed pre, pre.file,pre.code to DokuWiki's style sheet.
 
 22 Nov 2009
 10:00  Fixed ommitted space after format characters (bold, italic, delete, underline.
 17:58  Omitted space after //<// (actually //&lt;//) so that it can escape open angle
 bracket without placing a space after the bracket.
 
  All basic formatting characters  are followed by a space, which means that you
  can't apply them to an internal word  character without opening a space between
  the characters that precede the format character and the character that 
  follows:
         te**x* 
         
         t  
 24 Nov
 Upgraded the plugin tool (syntax/dwplugin.php) so that it accomodates plugins
 with enclosed text as in <span>text</span>

 Also fixed plugin tool to handle text from more than one instance on a page of the
 same plugin, otherwise text of last instance will overwrite all other
 instance.
 
 19:45:  Add missing space after link markup [[url]] by appending space to final 
 set of brackets: ']] ' in the end markup array.  Seemed simplest fix.
 
 Fixed bug which left beind empty url brackets after footnotes were edited during
 section editing.  This is because the section places footnotes for the section
 at bottom of section page, and they are saved with the section save and 
 appeared  when the full page or sectoin is  re-loaded.  
 
 25 November
 Removed space before punctuation when marking up urls (see 24 Nov 19:45)
 
 26 November
 9:37:
  Added support for url nice re-writing for images
 
 10:41
  Removed %% characters from samba share names, when the link tool creates the name from
  the share [[\\Myshare\folder\file|\\Myshare\folder\file]].  Not a problem is
  use gave share name in advance: [[\\Myshare\folder\file|Myshare]]
  
 21:40
  Upgraded caching mechanism of syntax/dwplugin.php, which was preventing all files
  from being cached.  The fix was to set a time limit on the files which use plugins,
  which is written to the file's meta file.  Only files wich have a current filestamp
  in their meta files will not cache--this is required for dwplugin, since otherwise
  plugins with embedded text do not update.
  
  23:30: The punctuation fix for urls (Nov 25) would cause space to be removed 
  if any of the text following a ]] had a punctuation character, so  fixed the
  regex to seek only punctuation which immediately follows ]].  In chars()
  function.
  
  27 Nov
  6:54
  Improved FCKeditor plugin tool so that checkbox for removal removes plugin tags
  entirely instead of just removing title attribute.  This leaves behind the text,
  including syntax markup with tildes, if any.
  
  11:08
  Updated meta.php so that an edit button is not displayed when the user switches
  from FCK editing to dokuwiki editing, because saving in that context from a
  section edit, causes the document to be saved with data duplication.  Instead,
  there is an Exit button with the tool tip indicating that the user must exit
  in order to swich editors.  Also turned off the prieview checkbox for the
  DW edit mode.
  
  28 Nov
  Added gone-missing CSS for shares in editor area
  
  Added experimental dwplugins.php for auto stet plugin, which creates literals for all
  enclosed text between <plugin title="stet"> and </plugin>.
  
  Added checkbox selector to plugin dialog that enable users to select stet
  instead of having to type in, or even know, that the plugin name is stet.
  
  29 Nov
  Upgraded plugin tool dialog to clarif separation between Stet plugin and the
  plugin tool.
  
  Fixed bug where h4 header printed as h3
  
  Fixed bug where solitary % sign is deleted.
  
  Fixed deleted space after monospace (HTML code) markup
  
  30 Nov
  Impelemented  mechanism to handle external mime types, like xls and pdf, which are
  placed in curly brackets and coded like local links.  Then these are fetched using
  lib/exec/fetch and set up for downloading by user.
  
  The above changes are still in test stage and am waiting for results from tester;
  the impelentation is in action/edit.php.external_mimes.
 
 
 1 Dec
   Tester did not have succes but I can't reproduce errors.  
   Fixed conflict between external mime types and external images both, which became 
   confused because both use curly brackets and both come with links using http:// protococl
   
 2 Dec
  Tested against 2007 ver. of DW and changed test clause for external mimes.
    
 3 Dec
  By-passed space deletions for non-parsed blocks in chars()
 
 
 5 Dec
 Added limited support for table rowspans.  Rowspans cannot be assigned to cells in two
 columns which have overlapping positions,  That is, cells 1-2 in column one and cells
 2 to 3 in column two will lose cell 2  in column two, it will not appear at all.  Rowspans
 can be stacked in a single column, e.g. cells 1-2, 3-4 of column 1.
 
 Column Spans can be combined with rowspans.
 
 7 Dec
 Improvements to Link File Browser, now opens file browsers both for internal links, in
 DW's data directory, and for  extra mime types (e.g. tgz, xls) which have been uploaded
 to media directory; and handles configuration of urls for these types.
 
 Applied Dokuwiki's file naming protocol to all uploads (lower case and spaces=underscore);
 previously only applied to images
 
 9:44 Disabled upload for local files in data/pages directory.
 
 9 December
 Added footnote editor, using name inertHTMLCode (adapted that plugin for this purpose)
 fixed Stet plugin to accept paragraph and line breaks (both in fckeditor plugin fiels and
 in syntax/dwplugin.php
 
 10 Dec
 Impelemented new protocol for handling HTML angle brackets:  on loading file into
 editor, at server (in edit.php), the angle brackets for code blocks get internal spaces
 and  outside of code block the initial bracket is put into italics.  On saving these
 are removed, in the JS parser, leaving the wiki file in tact and displaying 
 it correctly in the browser.  This process insures that the FCKeditor will not treat
 the brackets and the  text between the open and closed brackets as HTML tags and drop
 them  from the display.
 
 17:13  Excluded <plugin>. . . .</plugin> from above translation, so that ~<~ and ~>~ remain
 in  tact.
 
 13 Dec
 Restored missing rowspan setting to table cell properties dialog
 
 12:09 Added space after acronym, which was deleted when DW inserts acronym tags
 
 17 Dec
 Prepended colon to image urls created when using url rewrite rules
 
 19 Dec
 dialog/fck_link/fck_link.js:  created nice link text for internal links and links
 to internal other mime types, where these texts are not pre-set and selected by user in editor. 
 
 23 Dec
 Removed extra spaces from angle brackets in stet plugin
 
 24 Dec
 Plugins:
 1. New protocl for handling plugins, in experimental branch 01.02.  
 For most plugins, it is not necessary to use the plugin tool.  Only if the plugin does
 not work, then the  plugin tool might assist.  In this version, the user
 types in the plugin as he/she would in standard DW.  editor.php  escapes the following
 characters: {}:~?! by adding a space character after each of them, before they are
 processed by the DW parser.  Consequently the plugins are not processed as such, but
 their syntax remains on the page in the escaped form (i.e. with the space characters).
 When the file is processed by fckgLite, after the parsing is done, the spaces are
 removed and the file is saved with the plugin syntax in tact; therefore, DW never knows
 about the ecaped syntax and the plugins are treated normally.
 2. There is a new configuration setting, with the variable name 'xcl_plugins'.  Some
 plugins are meant to become a permanent part of the page.  If so, the plugins
 listed in this setting will be excluded from the escape process.  There is 
 one exception:  all opening angle brackets are automatically escaped in the editor.
 So, as of the present, if your plugin uses HTML-Style tags, it cannot be excluded, 
 that is, it will be automatically escaped before being loaded into the editor.  
 
 25 Dec
 Added a plugin editor to the Plugin Tool for editing native DW plugins, i.e. plugins
 not created with the plugin tool
 
 
1 Jan 2010
 Implemented an acl governed file browser.  The acl can be turned off in the configuration
 manager by changing the file browser's default setting from acl to none.  

2 Jan
  Removed debugging output from fckeditor'r config.php 
  
  12:23
   cleaning up some PHP notices being output to logs 
   
5 Jan
  Upgraded file browser, which is now set to open in one up from  user's folder and to
  exclude directories from hierarchy which do not have acl permisssion.
  
  Replaced FCKeditor's accepted file types for upload with file types listed in mime.conf
  
  There are now several addition configuration settings which control whether user has full
  or only partial access to file browser hieracrchy.
  
  Upgraded code to sanitize filenames of uploads so that they more rigorously conform to
  Dokuwiki style.
  This code now uses the $conf['sepchar'] setting to replace non-dw-canonical characters.
  
  
6 Jan
 Fixed regexes for plugin escapes in edit.php so that they can handle plugins with
 ampersands.  
 
10 Jan
 Fixed acl recognition code in commands.php for folders, both in main directory listing
 and in directory sidebar.
 
 Color-coded icons for read-only folder: they are now blue, uploadable folders are yellow
 
 In commands.php GetFoldersAndFiles(), added code to create directories when these are
 not created by the browser code.  This happens when the browser opens in a folder which
 is hierarchically prior to a new namespace in which a file is being created. 
 
 11:51
 Changed method of retrieving attribute values in GetFoldersAndFilesCallBack and changed
 variable 'class' for 'folder_class'-- in order to accommodate IE.
 
 22:49:
 Fixed bug in commands.php GetGoldersAndFiles() : $sFolderPath is returned from
 GetResourceTypeDirectory() in the current directory, not as I had it, in the root media directory.
 
 11 Jan
 8:27 
 Revised error reporting in GetFoldersAndFiles for failure to create a directory where
 user doesn't have permission to create in the namespace.
 
 13 Jan 
 Removed empty tabs from link and image dialogs
 
 14 Jan
 Removed automatic switch-over from FCK editor to DW editor.  Now when "DW Edit" is pressed,
 the document is saved and the editor exited.  When use next clicks "edit" the editor is
 DW.  This is to protect against some elusive bug which (though rarely) causes loss of text
 when switching between editors without first exiting.
 
 15 Jan 
 Added support for Dokuwiki email markup
 
 16 Jan
 Added code in meta.php set_session() to handle cases where user gets CSRF warning because
 fckgLite uses its own SESSION. There is a configuration setting in the configuration
 manager which enables the admin to set the 'csrf' setting  to true, if the site gets
 CSRF warnings.  In this case, fckgLite piggy-backs onto the Dokuwiki session.
 
 Hopefully fixed insistent bugs that corrupt up creation of new directories when then user
 opens file browser from the top of the media directory hierarchy.  In commands.php,
 GetFoldersAndFiles().  Still to be re-tested is the Darwin algorithm.
 
 19 Jan
 Added sup,sub,del to list of tags which are not escaped
 
 Synched 0.03 edit.php with 02.03
 
 Added fix so that images are not gobbled up as text inside header markup:
  $text = preg_replace('/(={3,}.*?)(\{\{.*?\}\})(.*?={3,})/',"$1$3\n$2",$text);
 
 Using PHP's trim to remove multiplication of spaces at top and bottom of document.
 
 Corrected guest user access so that a guest with write permission can save.
 
 20 Jan
 Added About fckgLite Tab to About.html, including subversion number retrieved with Ajax
 from fckg/version
 
 21 Jan
 Fixed bug in commands.ph has_permission which removed open access permission for 
 configuration openfb and once more re-worked openfb permissions in hass_permission()
 
 23 Jan
 Changed name of getBaseURL to getBaseURL-fck in config.php (prevent possible name conflict
 with Dokuwiki code)
 
 Added fckgLite to dialog titles which show FCKeditor:  FCKeditor/fckgLite

 Upgraded spellerpages.
 1.  spellchecker.php now checks Dokuwiki's defaul language setting
 (from $conf['lang']) and checks whether a lan guage preference has been set via the
 fckeditor/aspell.php script. It gives priority to aspell selection )(communicated
 via FCK_aspell cookie).
 2. edit.php now sends request variable 'dw_conf_lang' to aspell.php, which holds
 current $conf['lang'], and this is printed at top of page as convenience to user.
 If the user has already selected a speller language previously, that language
 is checked in the radio buttons from which the language selection is made. 
 
  25 Jan
    Fixed small bug in ent_seri.php, where add.ent file was not automatically recognized,
    as stated in the HOWTO

  26 Jan 
  Added ~~NOCACHE~~ to plugins regex, so that it is always recognized (since it is not a true plugin.
  Converted markup for <BR> to '\\\\' from "\n", so that now the P-><BR> tool works correctly
      
 28 Jan
 Escaped vertical bar in plugin regexes
 
 29 Jan
 Fixed hole in fckeditor/dataEvent.js which did not recognize Safari or Opera when checking
 for locktimer activity in fckeditor editing window.
 
 31 Jan
 Improved algorithm for recognition of plugins in edit.php (for escaping)
 
 Fixed bug in dataEvent.js -- extra comma at end of function call
 
 4 Feb
 Replaced onload process in helper.php with Dokuwiki's addEvent, so that our onload
 doesn't conflict with other onload handlers.
 
  15 Feb
  removed trim in save.php where lists come at top of $TEXT, otherwise spaces get removed
  and corrupt list
  

  16 Feb
   Fixed bug in list handling that removed end tag from file and code blocks.     
   Removed  extra new lines that accumulated at ends of code and file blocks.
   
   Added urldecoding to internal media uri's (edit.php)
   
  17 Feb Cleaned up some XHTML
  
  20 Feb
  Added uri unencoding to url's in edit.ph so that the urls are saved in non-Roman
  characters where appropriate.
          
  In fck_link.js (dialog) converted url's which are in fact internal media to
  internal media format.

  21 Feb
  Fix for nested lists with bold and italic at intersections of ordered lists
  removed--corrupted nomaml lists.

  23 Feb
  Redid fix for bold and italic at intersections of ordered lists, which required new
  fix for corrupting of code and file blocks.
 
  Feb 24
  Fixed bug in edit.php which caused parser to return _false_ when it could not
  match this.attr.

  Feb 25 Added ~NOCACHE~~ to default plugins in edit.php get_plugins()

  Feb 27
  Added language support to FCKeditor window in edit.php.  Added a lang directory to
  fckg/lang where lang  files designated <lang>.php are stored.  Defaults to en.php.
  The language array is named  $fckg_lang.  
 
  Added support in edit.php parser for href=nntp://newsgroup.example.com
  
  

  Feb 27
  Fixed bug in commands.php which probably has its source in the ajax call from the
  browser windows. The upload directory path reverted to the top level directory
  after a failed upload from a user without permission to upload to the sub-directory;
  the visible directory didn't actually change but the subsequent upload was sent to
  the top level directory, regardless of ACL permissions.  This happened only in cases
  where restricted file browsing was in effect--which makes sense, since it would only
  be in this circumstance that the lower directory would have had to be saved
  somewhere.

 

  Feb 27
  Added language label for the FCKEdit button that is output in meta.php
  

  Feb 27
  Clarified label on lilnk and imge dialogs to make it clear the "Browse Server" also is an
  upload facility.  Changed it to "Browser Server/Upload"
  
  

  Mar 1
  Had to revert back to command.php of Feb 26, before changes to fix upload problem where
  file was sent to parent directory after upload failure, if a second attempt was made.
    

  Mar 1
  Added check which returns an error from Fileupload in commands.php if a directory does not exist.
  This can happen when there is an unsuccessful upload resulting from inadequate permissions.
  After an unsuccessful upload, FCKeditor reverts to the top level upload directory and adds the
  current folder to it.  /Top/Level/current may not exist.   If it does exist and is writable
  by the current user, then the file will be uploaded to that directory.  So far there has not 
  been anything I can do to prevent this behavior.

  Mar 2
  Removed Save button from FCK Edit screen, because it could result in duplication of text,
  in particular when used in conjunction with the Preview facility, i.e. after making a change
  (or not) and clicking Preview, then SAVE.
  
         
  Mar 20
  Fixed bug in save.php, where space was removed at top of file corrupting the first
  item in an unordered list. Ths ordered list has already been accounted for in
  the regex that deleted initial spaces.

 22 Mar  
 1. Added support for multi-line plugins which need to replace DW newline markup
 with standard new lines.  So that <br /> in parser subsitutes new lines instead
 of \\.  This involved new plugin class: syntax/special.php.  For more info see
 extras/README-MULTILINE-PLUGINS.
  
 2. Fixed bug in handling of Dokuwik internal links when produced via nice urls.
 The parser would miss these after reloading a page for re-editing.
 

 23 Mar
  Removed unused input fields from table dialogue at fckeditor/editor/dialog/table.html
 
 26 Mar
  included syntax/special.php which has been left out of previous (but not posted) dist.
  
  
 Mar 29
 Implemented Arno Pushmann's filebrowser upgrades.  File browser now opens in current directory
 in all cases.  For open file browsing, it opens in current directory but gives user access to entire
 directory structure through the directory panel at left of filebrowser.  A nice touch
 is that the current directory name now always appears at top of filebrowser.
  
 29 Mar
  Removed align field from table dialog
 

 30 Mar
 Added fix for https urls in edit.php at current line 750, changing 
     if(attrs[i].escaped.match(/^http:/))
 to
     if(attrs[i].escaped.match(/^https*:/))


 1 Apr
 Fixed bug in nice url handling of internal media files (at current line 750 of edit.php)
 Upgraded handling of email urls: 
    1. added email option to url dialog
    2. added mailto recongition to parser in edit.php


 2 Apr
 Added a space character to the right of the stet plugin, which othrwise swallows it up.
 This required adding a space character in both dwplugin.php (l. 58) and in 
 edit.php (l. 206):   $text = str_replace('</plugin>','</plugin> ', $text); 

 Disabled preview button checkbox during section edits for FCK Preview
  
 4 Apr
   Re-worked spacing between formatting characters and text or punctuation that follows,
   so that there is no space bwtween format and following punctuation and one space
   between formatting and other characters. Additions to edit.php:
        markup['format_space'] = '_FORMAT_SPACE_';
        var HTMLParser_FORMAT_SPACE      
        preg_replace done at end of parsing, where _FORMAT_SPACE is replaced
        by either space character or "", depending on context

  5 Apr
  Updated spacing algorithm for format characters (see 4 Apr for previous fix)
  

  6 Apr
  Updated spacing algorithm for format characters (see 4/5 Apr for previous fix)
  Added missing punctuation characters (comma, question mark) to regex which matches
  for punctuation 

 Added Dokuwiki line break character to end of tables.
 
 
 7 Apr
 Re-did end of table markup by adding <br> to end of table in renderer.php and removing
 Dokuwiki line break markup from end of table.  Gives best results in both IE and Firefox,
 though there are differences in output (which can be lived with).

 8 Apr
 Fixed bug in Javascript function aspell_window(), where  window.open for aspell.php   
 was not finding aspell.php.  Gave it th e full url to aspell.php instead of relative.

 10 April
 Added Confirmation query to FCK editor's Delete Button
 
 Fixed Confirmation query for 'FCK Editor' Button in the native DW editor. This button
 switches from native DW editor  back to FCK editor.  Previously, when Cancel was clicked
 the native  editor was exited and any new work was lost.  Now, if the user
 clicks Cancel, the editor is not exited and the user can then click Save.  When the
 Save button is clicked the work is saved and the next time an edit button is clicked, the
 user will be in the FCK Editor.
 
 Removed space before hypen following format character string.  Added support for mdash and ndash
 characters following format character string:  here space will be retained. (Format
  means bold, italic, underline, delete).

 12 Apr
 When switching back into FCKeditor from DW editor after new edits have been made in DW editor:
 1. Eliminated duplicate confirmation if Cancel clicked  in response to confirmation query
 warning you that unsaved edits will be lost. 
 2. Fixed blocked Cancel button that occurred after clicking Cancel to confirmation query.
 
 In 02.03 and 03.03 Added Configuration setting that enables administrator to hide
 DW Edit button.  Three choices: all, admin, none: display button to all users,
 to administrators or wiki managers only, or to no users.
 

 13 Apr  Fix for duplication of text when switching from a secion edit in DW editor back
 to FCK Editor and then saving from FCK Editor.  The save from the FCK editor caused the 
 duplication.    Solution is to convrt the 'FCK Edit' button from an edit action
 to a cancel action.  So as far as DW is concered it is a cancel and the use is
 switched back to the browser instead of into the FCK Editor.

  6 May
  Fix in geshi/fckplugin.js to handle insertion of HTML into Safari and Chrome.

  7 May 
  This is the first distribution of version 04 of fckgLite. It is not yet the official
  release, but it is kept current with version 03.  One major difference between 03 and 04 
  is that all the variations of fckgLite now support the language facilities
  that were previously only in the fckgLite_lang distributions.  There is
  information on the fckgLite web site about how to integrate your language.  This
  unofficial release coincides with a significant statistic in the life of fckgLite.  As
  of this morning, it has been downloaded to more than 2000 unique IP addreses.

  8 May
  Implemented process for inserting Dokuwiki emoticons into the FCKeditor window.  They are
  inserted as text and then afterwards display in the browser as images.  They are 
  accessed from the same Smiley tool as the FCKeditor smileys.  Changes to files include:
    1. updating edit.php to escape emoticon text strings before the text is converted 
    to XHTML and then converting them back to text after the file has been translated
    into XHTML  by the Dokuwiki parser in function _render_xhtml
    2. adding array of Dokuwik emoticon images and text strings to fckconfig.js
    3. adding additional javascript code to display this array in the smiley dialog,
    which is fck_smiley.html
    4. adding language strings for translation and updating fckeditor/lang/en.js

  Updated lang/lang-template.txt to reflect all recent language updates

  10 May
  Updated handling of smileys. There is now a configuration option which allows admin to
  choose whether smileys will show up as text or as images in FCKeditor window.  In either case
  the inital insertion is as text.  But if image is selected in configuration manager,
  then when editor is re-opened after a save, the smileys will show up as images.

  11 May
  Added new-line to end of code blocks to facilitate insertion of new text at end of block; 
  this is done after the text has ben converted to XHTML.


  4 Jun
  Fixed bug in edit.php which corrupted urls in footnotes.
     1. Return from both start() and end() before markup is applied
     2. In text() concatenate text for footnotes with the same index number;
        otherwise wherever a url occurs the text preceding and following is
        passed through ins separate chunks that appear to the parser as
        new notes.
        

  6 Jun
  Removed empty <sup></sup> tags left over at end of file from footnotes

  7 Jun
  Fixed error in handling of user_rewrite urls, which were corrupted on saves subsequent
  to the initial save.

 15 Jun
 Converted forward slashes in user rewrite 1 image urls to colons, eg. playground/img.png 
 to playground:img.png

  19 Jun
  Upgraded the language facility for fckgLite additions to FCKeditor

  19 Jun
  Added various missing language translations to the upgraded language facility

  26 Jun
  Added case insensitive recognition of image extensions in edit.php attribute loop when media
  type is assigned to media_type variable.  This accommodates, for instance, PNG extensions
  as well as png.

  26 Jun
  In cases of nice  urls, prepended root directory colon to internal links, which was already
  done for internal links that do no use nice urls.

  26 Jun
  In cases of nice  urls, prepended root directory colon to non-Dokuwiki internal files,
  e.g. .pdf, .doc.

  27 Jun  Updated copyright information, making it consistent gpl v2, including in the
  about tab of toolbar.

  28 Jun  Added fix to handle asterisk (*) in plugin regexes.  Created pattern %%\*%% when
  creating fckgLPluginPatterns.  The %% takes care of fact that all asetrisks are Dokuwiki
  escaped.

  30 Jun Impelemented re-editing function for link tool (in link.js), so that when user selects
  a link, the relevant link type dialog appears with the appropriate Dokuwiki markup in the text
  box, which can then be edited. This replaces the previous situation, where the user was
  presented with the URL dialog that held the url of the link and the protocol was 
  desginated as 'other'.  Now, for instance,  when editing an internal link, 
  the internal link dialog pops up and the text box holds the DW markup for the selected
  link.

  1 Jul  Fixed display text for internal media and internal links when user enters a namespace
  without entering the initial colon.  Before fix, without initial colon, the disaply text would
  show up as /dokuwiki_dir/doku.php?id=namespace.  Now it shows up as :namespace:name. . .

  1 Jul  Fixed display text for internal media and internal links when user enters a namespace
  without entering the initial colon.  Before fix, without initial colon, the disaply text would
  show up as /dokuwiki_dir/doku.php?id=namespace.  Now it shows up as :namespace:name. . .

  1 Jul  Added support in link tool for re-edits of unsaved Windows shares.

  2 Jul Javascript fix in meta.php setDWEditCookie() function. e.form['mode'] was not
  set, causing JS error which caused page diff to be presented to user when switching between
  DW editor and FCK editor.  The error was ignored by FFox.  Now e.form.mode is created as a
  new object if it doesn't exist and its value property is correctly set to 'fck'.

  10 Jul
  Fixed bug in handling of multi-line blocks inside table cells.  These were not recognized
  when initially created but only after saves.  The boolean HTMLParser_TABLE was set to true
  only when parsing HTML that had already been saved once.  This boolean signals parser
  to replace paragraph insertion codes with Dowkuwiki forced line breaks (\\).

  11 Jul
  Removed extra forward slash from parent folder path in io.php CreateServerFolder(),
  which caused XML error on some systems.

  12 Jul
  Corrected license info in FckgLite tab of About pop-up.  Removed
   "Permission required for commercial use"  statement.

  16 Jul
  Implemented code blocks inside tables and fixed line spacing inside code blcks to
  more accurately reflect editing.

  19 Jul
  Fixed Paste from Word tool so that it handles both MS Word and Excel texts.

  19 Jul
  Improvement to PasteWord: In dialog/fck_paste.js created regex that removes
  HTML paragraph markup from table cells.  This will not always work with tables
  that have been copied from Excel into Word, where the text witin the paragraphs
  contains newlines.

  19 Jul
  Removed paragraph markup from MS Word table cells in Gecko browsers.

  21 Jul
  edit.php: chars():  removed %% escapes from windows path backslashes.

  25 Jul
  edit.php: 
  1. Added support for nested code markup; that is, as in standard Dokuwiki, <code> markup
  can occur in a <file> block and vice versa.  So 
              <file> 
                   <code>. . .</code> 
            </file>
  will yield a file block in which the code markup appears as text.
  2. Monospace markup now supports html entities, as in Dokuwiki.

  28 Jul
  fckeditor/editor/php:  
  1. in config.php created access to Dokuwiki's 'conf/dokuwiki.php' and its static $conf values. 
     Used in php/config.php to assign Dokuwiki's file and directory create permissions 
     to the FCKeditor's $Config['ChmodOnUpload'] and  $Config['ChmodOnFolderCreate'].
  2. Used in commands.php FileUpload() to set sepchar, deaccent, and useslash, if session
     fails.

  29 Jul
  Upgraded the spell-checker scripts, aspell.php and spellechecker.php.  Added OS 
  detection to both and in aspell.php changed the Windows path to the full Windows
  path C:\Program Files\Aspell\bin\aspell.exe; otherwise it will not be found on
  systems where aspell has not been set in the Path Environment variable.

  30 Jul
  Automated binary checking for aspell in new script fckeditor/is_aspellWindows.php; this
  secript is required by both aspell.php and spellerpages.php, and will assign
  the correct binary for Windows or Unix systems.
  
  aspell.php:  added path variable for FCK_aspell cookie as path=/ 
               added require_once('is_aspellWindows.php').  Also edited
               the error message printed to screen when binary fails to alert
               user to consult fckeditor/is_aspellWindows.php.
  spellerpages.php: added require_once('../../../../../../../../../conf/dokuwiki.php');

  3 Aug
   Introduced updated version of the spellchecker which attempts to deal with unrecoverable
   errors that freeze the spellchecker.  It also gives the user the option of clicking OK
   when the spellchecker comes to an end of its check and fails to exit cleanly.
   The OK button also enables an exit before the spellechecker exits on its own.

 4 Aug
 Changed $_REQUEST['id']  to $ID, when creating FCK_NmSp cookied, since $_REQUESt['id']
 doesn't work with user rewrites.

 8 Aug
 Attempt to fix spellchecker which chokes on urls.  The fix is in 
 fck_spellerpages.html,  where internal of urls are initially replaced by indexes 
 (in onload) and then re-inserted  at end of check in oSpeller_OnFinished.

 9 Aug
 Add space character after external mime markup in end() by changing tag from
 "}}"  to "}} ".

 15 Aug
 Fixed bug which mistook internal links for media files when the internal links had
 dot in file name, e.g. file.org.txt.  Changes to fck_links.js and edit.php. 
 For files that have been saved, edit.php uses Dokwiki's wikilink class to 
 identify internal links in these instances. For newly created links it uses the
 type attribute, which is set to 'other_mime' in fck_link.js.

  16 Aug
  Changed $_REQUEST['id']  to $ID, when creating Session, since $_REQUESt['id'] is
  not present when using nice urls with user- rewrite
 
  Added to  ok function in fckg_link.js so that it outputs two new attributes for
  internal urls that are used in edit.php to distinguish between media and internal urls:
       set type to internal
       set title to the current namespace
  edit.php picks up the title attribute for the url.  This affects sites that use nuice urls.

  
  
   Fixed bug in edit.php which assigned namespace value to title attribute without
   pre-pending colon.  Affects only nice urls.

 18 Aug
 Fix for unrecognized urlencoded image paths in file browser and edit.php.
   fckg_image.js, function SetUrl():    
      changed 
        GetE('txtUrl').value = url;
     to
       GetE('txtUrl').value = encodeURI(encodeURI(url)); 
   This creates correct encoding for displaying image in preview pane and FCKeditor.

 edit.php, added to img/src section of attribute loop:
        this.attr = src;
        if(this.attr.match && this.attr.match(/%[a-fA-F0-9]{2}/)) { 
            this.attr = decodeURIComponent ? decodeURIComponent(matches[1]) : unescape(matches[1]); 
            this.attr = decodeURIComponent ? decodeURIComponent(this.attr) : unescape(this.attr); 
       }
  This converts encoded path elements back to native characters, which Dokuwiki requires.

  19 Aug
  Fixed bug in file uploads and directory listings of filebrowser giving
  incorrect directory for non-admin user when non-admin user was not in
  root directory.  Involved fixes to command.php (removed appending of toplevel
  Session parameter to $currentfolder in FileUpload, where it had worked because
  Session was not actually being found) and to config.php (to FileTypesPath, from which
  current directory was removed so  that the absolute directory was passed in).

  20 Aug
  Fixed path to media directory in config.php for Windows systems; was corrupted by previous 
  edits of Aug 19.

  Fixed bug in 03 distributions in util.php's folder_as_entities() which caused file browser
  to fail with "Can't create directory" message in Windows (or when using windows Style
  in Unix/Linux).  The regular expression determining the filetype contained "media", and
  with win OS or winstyle the directory for the file browser is /data/media.
  So the bug was to mistake that directory for a file type.

  Correction to config.php to define $Config['isWinStyle'], which is required for
  03 distribution in util.php folder_as_entities().

  23 Aug
  Fix for Geshi quotes.  In edit.php preprocess() the text entity &quot; is converted to
  numeric entity &#34;, otherwise the spacing following the quotes becomes corrupted
  during  parsing. (fckgLite converts all double quotes to the text entities in
  _render_xhtml(), because Dokuwiki represents these as UTF-8 and the fckgLite parser
  ignores them.)
  
  Commented out javascript assignment to changecheck in meta.php preprocess(); changecheck
  does not exist, hence causes browser error.

 25 Aug
 Removed debugging file output from connectors/php/util.php.

  27 Aug
  Updated info hashes in edit.php and meta.php.

  31 Aug
  Fixed bug which caused browser to be corrupted when double or triple dash (em and en dashes)
  was included in headers.  Replaced them in edit.php chars() with &mdash; and &ndash; when
  occurring in headers, otherwsie leaving them as is for Dokuwiki to handle.

  6 Sep
  Fixed bugs in non-acl distribution:
  1. bug which prevented non-admin users from seeing entire directory listing
    (fix is to set dwfck[isadmin] session vriable to true for all users).
  2. bug which prevented creation of directories
    (fix was to go back to original version of CreateFolder() in commands.php
    which gives access to $_GET global, where $_GET['NewFolderName'] holds
    the name of the folder to be created; this was accidentally deleted)

  Harmonized session id cookie of 0 distro with that of 02 and 03, so that now
  all distros use the same cookie for this purpose. 
  
  8 Sep
  Upgraded filebrowser/connectors/php to work with Ubuntu which requires Cookie
  array instead of Request array to access the namespace and session id cookies.


   Added new doc directory with doc.zip, which holds the fckgLite web site documents
   in html format.

  10 Sep
  1. Added Dokuwiki name sanitizing to Folder creation in non-ACL distribution.
  
  2. Implemented a backup feature for the editor, which backs up whatever is in the
  editor window to a file in the meta directory named <namespace>.fckg. In other
  words, in the case of section editing it saves only the section being edited.
  This save occurs when the Refresh button is pressed.  
  
  Also, when Refresh is pressed the current state of the document is saved 
  in a hidden window.  A new Revert button has been added which will cause this
  saved text to be restored to the editing window.  The saved text remains
  in memory until the Refresh button is once again pressed, when it is replaced
  by whatever is currently in the editing window.

  There is a configuration setting in the configuration manager which enables admin
  to turn on and off the saving of backup files to the meta directory.  The default
  setting is false.  So this must be set to true if the admin wants backup files to
  be saved.  This setting does not affect the Revert mechanism in the browser.

  12 Sep
  Changed name of Revert button to "Back-Up"; it still does a lock timer refresh but name
  reflects more accurately the purpose of the button.  Changes are made in action/lang/en.php
  for name change.  
  
  Minor changes in edit.php to (1) prevent duplicate loading of en.php as default
  language file and (2) to assign correct button and title strings for the
  Refresh/Back-Up button, in event that older language files have not yet
  created strings for Back-Up button and title.

  13 Sep
  Added facility to delete files from file browser.  Required changes to command.php,
  to which was added UnlinkFile(), config.php, and connector.php.
  
  Improved algorithm for checking ACL in command.php, offshoot of above.

  14
  Added new configuration manager setting to enable folder creation in file browser.
  Guests are prevented from creating folders, even if folder creation is enabled.
  
  Added urlencoding to folder names when creating folders.

   Added warning to Revert button for empty backup buffer.

  15 Sep
  Partial fix for creating non-parsed blocks in IE.
  
  IE fails to pick up the class attribute for non-parsed blocks from the Style menu,
  which is what identifies what kind of block is involved, code or file. 
  Consequently the attribute resolves to 'false', resulting in a start tag of <false>.
  The hack to get around this, described on the fckgLite web site, is to create an
  initial block of either type, code or file, and then to insert the cursor
  back into the block and select again the type of block required.  It doesn't matter what
  kind of block the first attempt is, the result will always be the second type selected.
  
  Because of the missing attribute, the parser can't know the type of block required.
  However, it now picks up the initial false result and creates a valid code block
  on the first try. To create a file block, you still have to use the double selection
  method.

  18 Sep
  Minor change to edit.php in parse_wikitext(), start()-> attribute loop: incorporated
  else href clause into if 'a' clause. 
  
  Added Backup message indicating that a backup has been made and to which file.  Appears
  below editing window and editing window buttons.

  19 Sep
  Brought file browser colors into accord with tool bar's silver skin.

  20 Sep
  Fixed style issue in fck_image.html and fckg_link.html which prevented full display of
  image and link dialog until they were either re-accessed or a text was entered int the
  editor window.  This was not an issue in Firefox; it seems to have been a matter of
  a delay in the Javascript enabling elements where the display style was set initially
  to none.

  21 Sep
  Added confirmation check for deleting files using the  file browser.  In frmresourceslist.html
  UnlinkFile, returns false if Cancel.

  22 Sep   
  Reconfigured the backup message, which when too long for the browser corrupted
  display.
  
  23 Sep
  Added support for ACL %USER% wildcard.  
  
  With this distribution, fckgLite initiates version 05, which eliminates the earlier
  three-fold versioning system.  This version can be used for non-Roman characters
  in URL's and path names, the previous 03 distribution; and using configuration
  settings it can be turned into a non-ACL, single user installation, which in
  previous versions was the 0 distribution.
  
  24 Sep
  Fixed bug in edit.php in url decoding of image src attribute in condition
  where double decoding occurs. The bug took its conversion object from
  the matches array instead of from the src variable which had been created
  from matchs[1] and had replaced all forward slashes with colons for Dokuwiki
  namespace compatability.
             
  25 Sep
  Removed debugging output from check_acl.php
        
  Upgraded non-Roman character handling in command.php and frmresourceslist.html,
  so that they correctly process multi-level subdirectories and ACL in
  file uploads.  Added new function encode_dir to commands.php to properly
  encode paths.
  
  28 Sep
  See 22 Nov 2009.  Internal word character can now be marked with formatting
  character without opening a space after the character.  This works only with
  single formatting, i.e. it will not work if a character is marked as both
  bold and italic.  
   
  29 Sep
  Fixed link dialog window so that it displays the complete dialog in Ubuntu.  In
  js/fckeditorcode_gecko.js, added code that recognizes Ubuntu and changes size of
  height and widht.  In dialog/fck_link.html body tag enabled scrolling and auto
  overflow in style attribute. 

  30 Sep
  Internal number characters can now be formatted.  See Sep 28.
  
  3 Oct
  Restored lost minor edit checkbox to editing window (lost probably due to changes in
  DW's handling of form elements in the past year).
  
 10 Oct
  "Lazy Sunday": Possible problem loading fckgLite's javascript with Dokuwiki's
   standard interface. The following describes the fix.

  The function LoadScript() has been moved to  meta.php's fck_editor() function
  so that it can be accessible from both the   FCKeditor and from the Dokuwiki editor.
  Previously it was included in edit.php and accessible only from FCKeditor.

  A compressed version of script.js has been placed in fckg/scripts, which is called
  script-cmpr.js.  This script is called in the event that Dokuwiki fails to load
  fckgLite's standard javascript file.
  
  11 Oct
  Implemented escapes in plugin syntax for troublesome characters like asterisks: 
      /*/
  By bracketing them in forward slashes the parser in edit.php keeps the original as
  is. Otherwise they could get escaped by DW-style percent signs:  %%*%%.  This
  breaks the plugin syntax.
  
  12 Oct
  Change names of Style and Format menus to "Code Types" and "Headers".
  
  13 Oct
  Added CTRL-key combos to create headers and monospace from keyboard.  For
  headers CRTL-1 to CTRL-5 create the five header sizes.  CTRL-M creates
  monospace.
  
  14 Oct
  Fixed spacing to right of Acronyms, so that it handles punctuation, like dashes, correctly,
  no space where there is no space, space where there is:  ACL-compliant and ACL - compliant.
  Uses _@ACRO_SPACE@_ place holder to mark location.

  Fixed bug in handling of footnotes created by footnote editor. (Text following the
  note number was being lopped off and spaces after note number did not parse
  correctly.

  Fixed bug which caused new-lines to be placed around internal links when they
  link to the same page that they are on.  Primarily a problem in lists which
  they corrupted.  Resulted from a span of class=curid, which identify and
  supposedly highlight those links and which enclose those links. (curid =
  currents id?)
                  
  15
  Fixed unintended consequence of 11 Oct escape for plugins, i.e. that it
  deleted the dokuwiki \\ markup for line ends.
  
  Added CTRL+0 to keyboard shortcuts, which behaves as Normal from headers menu,
  in effect converts the current header markup to p and will convert code
  blocks to p.
  
  17 Oct
  Removed extra newlines from nested lists when list texts have formatted element,
  underline, bold, italic.  Strikeout cannot be use in nested lists.
  
  Preserved back-slash character in non-parsed blocks
  
  18 Oct
  Fixed bug in locktimer refresh function which had omitted the time reset when implementing
  the back-up feature on September 11.
                       
  22 Oct 
  Fixed bug in replacing _@ACRO_SPACE@_ place-holders; failed to handle correctly
  in tables because in certain situations in tables _@ACRO_SPACE@_ is followed
  by a space.  Changed regex from /_@ACRO_SPACE@_$/ to /_@ACRO_SPACE@_\s*$/
  
  25 Oct
  Turned off separate session for fckg when the admin panel is being accessed -- by
  checking for $_REQUEST['do'] == 'admin' in meta.php set_session().  It is set and 
  reads 'admn' when any configuration plugin is called.
  
  27 Oct
  meta.php:  created function loadScript(), where the LoadScript Javascript function 
  is output. loadScript() is called from TPL_METAHEADER_OUTPUT', 'AFTER 
  hook, so that it loads before the Javascript function is called when switching 
  back to browser.  Previously it was output from fck_editor(), which came in too late,
  when the fckgLite editor was not in effect, causing a Javascript error to be
  reported by Firebug.
  
  30 Oct
  Added Support for nowiki tag.
      
  Improved algorithm for escaping nowiki containers and added support for escaping
  angle brackets.

  3 Nov
  In meta.php:  restore Dokuwiki session id after setting up fckgLite's session, which
  prevents CSRF warning.
 
  4 Nov
  Conflated fckgLite Session with Dokuwiki Session and removed CSRF option in
  Configuration Manager.
 
  9 Nov
  Removed new line following format characters in lists, which broke the lists
  
  10 Nov
  Removed strtolower from FileUpload of commands.php, which converted url-encoded
  names to lower case.
  
  Implemented facility for handlng query strings with internal links; supports
  addition of this feature to Anteater.
  
  12 Nov
  Added language support for query string facility.
  
  Fixed extra space which opened up between formatted (i.e. bold, italic, etc) characters 
  and closed parentheses, square brackets, and open curly braces.
  
  13 Nov
  Added German language translations for editor interface in fckg/action/lang/de.php.
  Many thanks to the anonymous contributor.
  
  14 Nov
  Fixed list parsing:  
     1. Fixed deleted newline from lists where formatting character occurs at start of list
  line.  (This has to be watches ad it may cause nested lists with initial format
  characters to break. See the HTMLParser_FORMAT_SPACE/HTMLFormatInList block 
  after parse is complete.)  
     2. In start() function, fixed broken lists where acronyms occur at ends of list
  lines and where format characters occur at ends of list lines.
  
  Fixed error message response for internal link in dialog/fck_link/link.js.
    
  15 Nov
  Removed uncaught Acro_Space marker from lists.

  16 Nov
  Added check for existence of getVersion in helper.php.  Dokuwiki versions without this
  function are pre-Lemming versions. Versions without this function throw an erro and
  fail.

  17 Nov
  Fixed bug in edit.php in handling of query string recognition for the three types
  of urls nice->.htaccess, nice->Dokuwiki internal, none. QS and anchor was duplicated
  and/or lost.
  
  Added anchor faciliity to link.html, with drop-down menu of headings from the
  current file which can be selected an inserted as anchors.
  
  18 Nov
  Removed '.txt' extensions from file browser display of internal link file names,
  and excluded non-image files from file browser display of Images.
  
  19 Nov
  Added image viewing to file browser Image selection window.
  
  20 Nov
  Added automatic display of thumbnails in image file browser and a magnify
  window to view images enlarged.
  
  21 Nov
  Improved thumbnail updating in image file browser window.
  
  22 Nov
  Escaped double angle brackets << >> which were converted into chevron entities (edit.php).
  
  23 Nov
  Fixed nested lists so that mixed nested lists and at various depths are supported.
  
  Put in temp fix in frmfolders.html for elusive bug which causes current folder to
  be /lib/plugins/fckg . . . when returning to file browser after browsing imges previously.
  Happens only when url-style encoding is in effect.  Fix is to change the folder p`ath to '/'.

  
  24 Nov
  Included fix in meta.php, where this above issue orignates when $ID is set to
  the media image directory.

  Using fckgLiteSafe version of frmresourceslist.html together with safeFN_clss.js--
  adopted the fckgLiteSafe process for loadng image files into the file browser, without
  using Image.onload and Image.src.  This gives direct, immediate access to the files
  on the server, from wich the image dimensions are picked up using php's getimagesize(),
  for resizing thumbnails.
  

  25 Nov
  Fixed escaping of special characters inside plugin syntax by taking into account
  that they may already have been esapced with Dokuwiki percent escapes. Our escapes
  here are backslashes around the special characters, and the regex looks like this:
    results = results.replace(/%*\\%*([\*\-\%\\])%*\\%*/g, "$1");

  Added an insert button to the magnify image window.
  
  Fixed bug in renderer.php which omitted final div tag from table_close
            
 27 Nov
 Added virtual keyboard plugin to FCKEditor, based on Virtual Keyboard Interface Script - v1.43
 Copyright (c) 2010 - GreyWyvern.  Enables data entry in (currently) 86 language 
 character sets. 
 
 28 Nov
 Upgraded virtual keyboard plugin.
  
 7 Dec
 Added folder ACL check to folder creation in commands.php.
 
 Implemented file and folder encoding for Windows in unlink and folder creation functions,
 which had been overlooked in earlier distributions.
     
 10 Dec
 Added file move facility to filebrowser.
 
 11 Dec
 Cleaned up filespec in commands unlink() move facility
      
  12 Dec
  Placed .htaccess file with Options -Indexes in userfiles.
     
  13 Dec
  Fixed bug in filebrowser move/delete file features which prevented deletes.
  
  Updated language file and template for move facility.
  
  Revised FCKeditor regex in io.php which (in Windows) rejected path names 
  in URL and Safe formats.

  14 Dec
  Revised code in helper.php for checking DW version, since DW's getVersionData() can't
  report back a valid version date if the user has not included a proper version file
  in the DW root directory.
  
  16 Dec
  Added URL-encoding to folder creation in commands.php CreateFolder and Unlink.
  
  Added URL-decoding to current folder display (top of filebrowser) in frmactualfolder.html.
  
  18 Dec
  Added support for Macintosh to filebrowser's move facility.  Needs Cmd+trash can
  to activate move faclity, rather than Ctrl+trash can.  Also replaced 'Ctrl' with
 'Cmd' in the icon hints at bottom of browser window when the browser detectsa Mac.

 19 Dec 
 Updated FckEditor lang/en.js and lang-template.txt
 
 Added code to dialog/get_headers.php to treat multiple headers with the same name
 as in Dokuwiki, by adding an incremented numerical suffix to the header hash, as
 in #hash, #hash1, #hash2. (get_headers.php outputs through an Ajax call a list of
 headers and their cleanID's available to an internal link.)

 22 Dec
 Added support for page anchors which are not prefaced by namespace:page, as in
 [[#top|top]] instead of [[:namespace:page#top|top]]

 23 Dec
 Put version check into fckg renderer.php for table close(), since prior to anteater
 (Nov 7,2010), tables were not embedded in a Div.
 
 27 Dec
 Converted % and [] to nowiki escapes in edit.php (i.e. converting them to entities before
 passing them into DW parser).  The brackets in particular are useful because they prevent
 url markup from being converted to HTML urls in FCKeditor.

 28 Dec
 Fixed escaping of backslash characters in edit.php which were lost when implementing
 accommodation of troublesome characters in plugin syntax.  Now any character that
 causes trouble for a  plugin can be escaped with backslashes except for the backslash 
 itself and the percent character.  A backslash must both precede and follow the
 character being escaped, as in: \*\.
 
 2 Jan 2011
 Added backslash and curly brackets to nowiki entity replacements in edit.php _preprocess()

 
 Upgraded Immutable Plugin feature: (1) immutable plugins now keep their HTML formats
 and (2) they can be edited in the plugin tool's editor, either the content or the
 raw plugin syntax.

 Also added fckg_font plugin to fckg/syntax, which enables setting of font family,
 size, and weight.   
   
 4 Jan 2011
 Fixed bug in code blocks which multiplied backslash characters (in edit.php: chars:)
 

 5 Jan 2011
 Added fonts plugin to FCKeditor, tied into syntax plugin font.php.  User can set font,
 size, weight with plugin and edit these features.  The plugin's text can be
 edited in situ. edit.php parser has been upgraded to handle the font tag and create
 the font plugin syntax, which is what is saved to the DW file.  
 
 Added additional error checking and language texts to fonts plugin.
  
 6 Jan 2011
 Added a Remove All formatting facility, which removes the font tag which formats
 the text.
  
 Added the fckg_font plugin to the permanent list of excluded (immutable) plugins in
 edit.php get_plugins().
 
 Removed new lines from immutable plugin texts when edited in plugin tool editor.
 
 7 Jan 2011
 Fixed bug in fonts plugin tool which caused tool to fail when text was not selected
 in Safaris and Chrome.
 
 Added samples pane to fonts plugin tool.
 
 Fonts tool: Added auto recognition of non-standard font sizes, i.e. em and px and point
 sizes not included in radio button selections.
 
 10 Jan 2011
 Stripped PCRE caret from fronts of plugin regexes, when creating plugin string in edit.php
 get_plugins().  They are not needed for fckgLite's plugin recognition and parsing and
 cause plugins not to be recognized, since they indicate start of pattern and in fckgLite
 all plugin patterns are combined into a single string.
 
 Fixed incorrectly escaped backslash character in callback function that replaces nowiki
 characters with html entities (edit.php).

 11 Jan 2011
 Upgraded plugin tool: in raw syntax mode the edited HTML text is now inserted in place in the
 FCKeditor, whereas previously the edited text did not appear unitl after a save, when
 the new raw plugin text replaced the old.

 12 Jan 2011
 Added check to edit.php _preprocess() that enables user to bracket plugin-type syntax pairs
 between Dokuwiki percent escapes, as in %%<WRAP>%%.  It converts the percents to nowiki
 tags.  It's a convenience to escape plugins for comment-type situations
 without fear that matching closing markup will be mistaken for the plugin itself. The check
 is for pairs of the following characters: ~#:^ and then these pairs: {} <>. But
 it also covers situations where a file is imported into fckgLite which may use this
 technique.

 15 Jan 2011
 Fixed bug in handling of Geshi blocks, where extra newlines were inserted after 
 uncaught Geshi span tags.
 
 20 Jan 2011
 Upgraded fonts plugin to handle font color.
 
 Implemented a fix for tables which take on extra cells when text markup
 is included in a colspan cell.
 
 25 Jan 2011
 Additional code and fixes to handle complex configurations of table colspans.  
 (Still to be done: better handling of table header markup with colspans; the colspans
 are accurate but the header markup gets lost in some configurations.)
 
 30 Jan 2011
 Added CSS to FCKeditor's editing area (fck_editorarea.css) to match dokuwiki's handling of
 link display.  This required outputting matching classes from fck_link.js, which 
 results in matching link colors and link icons.
 
 31 Jan  2011
 Added CSS for editing area email and fixed url for mediafile icon (See 30 Jan).   
 
 Cleaned up some extraneous coding in edit.php.
 
 1 Feb 2011
 Fixed deleted empty table cells that resulted from recent upgrade to colspans in
 table handling: insert into valid empty cells the temporary marker _FCKG_BLANK_TD_ 
 to prevent the empty td/th cells from being removed 

 Start tables with <span class='np_break'>&nbsp;<\/span> to isolate them from 
 top margin of edting window (in renderer.php)

 Added newline to end of end non-parsed blocks np_break markup (\n_fckg_NPBBR_\n) to keep 
  \n_fckg_NPBBR_ butting up; against intial table markup and so interfering with frist row of table

 2 Feb 2011
 Removed extra newline from nested lists where nested item ends with an acronym
 
 6 Feb 2011
 Change to file browser: When moving a file to a directory named 'secure', the filebrowser
 automatically includes an .htaccess file denying direct web access.

 7 Feb 2011
 Added updated .htaccess files to userfiles: one named .htaccess.security and one named
 .htaccess.open.  The open version is the default. It allows through all http requests,
 while preventing indexing.  The security version secures the media directory from all
 requests except requests for images. In the open version security is achieved by creating
 secure directories, which are created when files are moved, using the filebrowser,
 into directories named "secure", which is the default name for directorie to which
 files are to be moved. More details are available on the web site on the page
 describing the filebrowser: http://www.mturner.org/fckgLite/doku.php?id=media.

 9 Feb 2011
 Create Dokuwiki Smiley Array from conf/smiley.conf in fckeditor/fckconfig.js instead
 of from hard-coded Array, which still remains in fckconfig/js as fall-back.
 
 Fixed bug in edit.php that removed initial spaces from lists after code blocks
 in _preprocess()
 
 10 Feb 2011
 Removed bulleted and numbered lists from FCKeditor context menu.  They have no function
 for Dokuwiki and are misleading.

 23 Feb 2011
 Escaped [ and ] in regular expressions that reconstitute plugin syntax in edit.php.
 
 25 Feb 2011
 Added . and ? to above escapes (approx line 1797).
 
 26 Feb 2011
 Add a new configuration option 'dwedit_ns' which enables the admininstrator to designate
 namespaces where the FCKeditor will not be active; instead the native Dokuwiki
 editor will come up when those namespaces are part of the page ID.
 
 Appended a P tag with one nbsp to end of PRE tag before sending HTML to FCKeditor, so
 that code blocks that come at end of page do not capture edit cursor.
 
 28 Feb 2011
 Replaced short (<?) tag with full tag (<?php) in is_aspellWindows.php.
 
 2 March 2011
 Streamlined user interface to internal link module of link dialog
 
 3 Mar 2011
 Fixed 'dwedit_ns' option so that it works with nice urls.

 24 Mar 2011
 Added new configuration option which allows admin to decide whether or not 
 to allow users with upload permission to delete media files.  The default is to allow
 users with upload permission to delete files.
 
 25 Mar 2011
 Added LICENSE document to fckg directory and upgraded fck_about.html so that it automatically
 inserts correct copyright year from version info.
 
 3 Apr 2011
 Inserted space after closing font tag to prevent loss of space between end of font markup
 and start of next letter. Side effect of this is that fonts cannot be used inside a word,
 since the character after the marked-up characters will always be a space.

 9 Apr 2011
 Added facility in action/edit.php to capture template text output by the
 template event handler.  Previously fckgLite checked to see if there was
 a page temmplate to be processed for current $ID but it did not check
 to see if the template event handler had prevented normal template
 processing and inserted its own output.


 11 April 2011
 Inserted missing opening format markup in colspans.

 12 Apr 2011
 Experimental upgrade to table handling of colspans with text formatting.
 
 13 Apr 2011
 Added missing format-tag  space marker (@@_SP_@@) to tables where they were missed when
 preceded by lists (at current line 1710).  Above colspan upgrade apparently is working.
 
 When headers appeared in colspans they were converted to td's; this is now fixed.
 
 14 Apr 2011  
 Fixed bug which corrupted table cells when non-parsed block was included in cell by
 removing newline being inserted after npb closing tag.
 
 17 April
 Added patches in edit.php and save.php to delete empty format tags left over when
 removing formatting from acronyms.  These work in conjunction with each other--those
 empty tags which are not removed by save.php are later removed when re-loading the file
 in edit.php. (Could use additional testing.)
 
 25 April
 Added fnrencode check for safe filenames in Dokuwiki v. 31 and later.
 
 01 May 
 Updated save.php to enhanced regex for removing empty acronym tags.
 
 02 May
 Removed extraneous code from dwplugin.php that was broken but meant to save plugin
 script info so that scripts would be loaded in meta.php when plugin
 was called for a page. This was not needed and based on misunderstanding of how 
 plugins are loaded. Companion code also removed from meta.php.
 
 Removed unused FCK Preview button and javascript funtion it accessed. This was
 left over from DokuWikiFCK and not used in fckgLite.
 
 05 May
 Added check for null $dwedit_ns at top of edit.php and in insertFormElement() of meta.php;
 if user happens delete all strings from the dwedit_ns configuration setting, an error is thrown
 by php (and in the case of edit.php) the editor cannot be changed back to the FCKeditor.

 Automated insertion of regex to convert %5D to ']' in the javascript function safe_convert
 in edit.php.  A check is done to see whether the new post_indicator version is in place
 and if so php inserts the javascript replacement function to convert %5D to ']'.
 
 Cleaned up much unused coding in meta.php left over from earlier versions of both
 DowkuWikFCK and fckgLite.
  
 06 May
 Inserted into auth_nameencode() of connectors/php/check_acl.php fix for Dokuwki
 FS#1955. 
      
 07 May
 Created wildcard branch which updates handling of wildcards (%USER%) to Anteater.

 Added new configuration option 'auth_ci', which if true sets username checks to be case insensitiv

 This version also respects ACL_AUTH 0, and hides files and directories for which user does not have
 permission.
 
 09 May
 Inserted space after Dokuwiki Smiley which was lost after save.
 
 12 May 
 Changed regex for handling angle brackets inside code blocks (edit.php _preprocess()), using
 entities instead of "< " and " >", &lt; and &gt;.  Patch submitted by morsik.darkserver.it.
